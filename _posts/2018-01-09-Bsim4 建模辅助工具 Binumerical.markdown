---
layout: post
title:  "Bsim4 建模辅助工具：Binumerical"
date:   2018-01-09 16:00
headerImage: false
tag:
- Tool
- python
- Bsim4
category: blog
author: whyeemcc
description: none
---

## Bsim

我一直认为Bsim的模型很不优美，就像做基本粒子的人可能会觉得凝聚态的一些处理手法很“脏”、近似很多。Bsim里有很多比较唯象的参数，概括了Mos晶体管Global上的特性，这样一来内部的部分物理过程可以不用去深究的，很典型的工程处理手法。但如小平同志所说，不管黑猫白猫，捉到老鼠的都是好猫，Bsim已经是非常成熟的工业标准，也是世界上唯一的晶体管模型标准，第四代的Bsim4模型，从0.13um到22/20nm 的技术节点，都一直在被业界使用。近些年进入市场使用的鳍式晶体管FinFet的芯片，即16/14nm及以下节点，则继续使用的是Bsim系列中的CMG模型。所以无论是Intel给你造的酷睿i7，还是隔壁做“智能垃圾桶”里的芯片，几乎都离不开基于Bsim标准模型的仿真设计。

## Binnable

Bsim为了建模工程师能对大量尺寸的Mos器件进行拟合，引入了参数的"Bin"特性，也就是对某些参数来说，它不是一个固定值，而是随尺寸变化的一个函数，对每个栅极长和宽进行不同的系数补偿，这是很不完美但是非常实用的做法，不完美在于：表征某个物理效应的同一个参数，在不同的器件尺寸下理应是一致的，但上面也提到了，这是一个工业标准，能用，够稳定就好！如果是一个更接近底层的模型，那可能会伴随着很多超越方程和复杂的积分，对电路仿真的收敛性和运算时长会是个不能接受的缺点。

## Binumerical

引入Bin特性的确是有利于模型，但是这个思路也带来更多的建模成本和风险，因为你不能从他们参数的本身直接看出来他的真正等效值是多少，在不同的尺寸下，这个等效值也是不同的，并且在不同的Bsim模型子框架下，等效的模型公示也不一样...往往我们需要将某个物理参数的等效值控制在一个合理的范围内，避免造成一些违背物理意义的模型和仿真上的error。自己做这个工具的初衷就是为了能很方便地告诉我哪些参数越界了，并能展示在哪个尺寸越界，而且是由哪个bin参数给的不合理造成的。于是我将它命名为"Binumerical"，即是"bin + numerical"合并而来的，意味着是“对bin的数值计算”。它的功能是解析一个具体的模型文件，读取出里面的一些尺寸和相关参数，然后对事先预制好的参数库进行遍历，计算出每个参数的有效值，如果出界了，说明它是不符合物理意义并且可能会带来仿真风险的，就将它列出来，并且在可视化区域给它“亮红灯”，对于模型文件中规定好的最大和最小的4种尺寸组合，运用饼图的方法呈现每个 Binning 参数的等效值的比例，哪一个系数赋值的不合理，就能一目了然，也可以直接在输入框里重新赋值，以供能调试出合理的结果。

对照着 Berkeley 所出版的 Bsim4 手册，我把400多个参数的定义和对应的warning信息都弄到了json文件里以供调用，并且给每个参数都赋予了上下界，光是整理这么多参数的时间，比写代码花的时间都长的多...

在配合模型拟合软件同时使用时，这个工具能尽可能早地避免在前期挖坑，减少重复返工的麻烦。

项目地址：[源代码](https://github.com/whyeemcc/Binumerical)，主界面如下图：

![image](/images/2018-01-09/Interface.png){: class="bigger-image" }

## 代码部分

增加了一条线程，把稍微耗时一点的绘图部分丢给了另外一条线程，这样在快速切换参数的时候，就不会有因为要等待前一张图绘完而阻塞所带来的延迟感了。



